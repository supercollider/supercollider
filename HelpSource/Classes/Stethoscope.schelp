CLASS:: Stethoscope
summary:: An oscilloscope
categories:: GUI>Interfaces
related:: Classes/ScopeView, Classes/FreqScope

description::
Stethoscope provides a complete oscilloscope GUI. It displays a window containing a bus-plotting link::Classes/ScopeView:: and an interface to configure the plotting and choose among the buses.


subsection:: Creation by message .scope

Several classes provide a convenient 'scope' method that creates a Stethoscope to display their data. See for example: link::Classes/Server#-scope::, link::Classes/Bus#-scope::, link::Classes/Function#-scope::.


subsection:: Keyboard shortcuts

The following keyboard shortcuts may be used when focused on the Stethoscope display:

table::
## strong::Shortcut:: || strong::Action::
## J || one channel back
## K || switch rate (audio vs. control)
## L || one channel forward
## O || jump to first hardware output channel and adjust numChannels to hardware
## I || jump to first hardware input channel and adjust numChannels to hardware
## space || run, if not running already
## . (period) || stop
## M || toggle screen size
## + / - || zoom horizontally
## * / _ || zoom vertically
## S || change style between parallel and overlay
## Shift+S || change style to lissajou
## Shift+A || allocate buffer size so it fills the screen (to next power of two) (this can be dangerous, might crash)
::

CLASSMETHODS::

PRIVATE:: key

method::new
    Creates a Stethoscope, either as a window, or placed on a given parent view.

    argument::server
        A valid Server (either a local or the internal server), or code::nil::, in which case the code::Server.default:: is used.
    argument::numChannels
        An integer. The default value is 2.
    argument::index
        The offset index. An Integer. The default is code::nil::.
    argument::bufsize
        The size of the analysis buffer. The default is 4096. See also link::#-bufsize::.
    argument::zoom
        Horizontal magnification of the displayed wave. The default is 1. See also link::#-xZoom::.
    argument::rate
        \audio or \control. The default is \audio.
    argument::view
        The optional parent view. The default is code::nil::. If code::nil::, then it will open in its own Window.
    argument::bufnum
        The id number of the Buffer to analyze. The default value is code::nil::. If code::nil::, then a Buffer of size bufSize is allocated.

    discussion:
    Example:
code::
s.boot
{ SinOsc.ar([330, 440], 0, 0.4) }.play;
Stethoscope(s, 2);
::


method::isValidServer
    Tests whether Stethoscope can operate on the given server (any local server. See link::Classes/Server#-isLocal::).

    argument::
        A link::Classes/Server::.
    returns:: 
        A Boolean.

method::ugenScopes
    Returns an array of the running ugen scopes.

code::
s.boot
{ [SinOsc.ar.scope, WhiteNoise.ar(0.5).scope]*0.1 }.scope(2);
Stethoscope.ugenScopes; // returns the ugen scopes
::

method::tileBounds
    A utility method used by link::Classes/UGen#-scope:: to tile scope windows.

    returns:: 
        A Rect.



INSTANCEMETHODS::


subsection:: Data

method::server
    The server on which the scope operates.

method::rate
    Whether to operate on audio or control busses.
    argument::
        One of the two symbols: code::\audio:: or code::\control::.

method::index
    The starting index of the busses to scope.
    argument::
        An Integer.

method::numChannels
    The amount of adjacent busses to scope (from link::#-index:: on).
    argument::
        An Integer.

method::bufsize
   Defines the maximum allowed link::#-cycle::.

method::cycle
    note:: Only available in Qt GUI ::

    The exact scoping period, in signal frames. Reciprocal to what is also known as emphasis::sweep speed:: in analog oscilloscopes. It is dynamically adjustable while the scope is running.

    Data from scoped signals will be accumulated into a buffer until it reaches code::cycle:: amount frames, at which point the buffering will immediately restart. The view will repeatedly display the entire buffer; it may skip a cycle if the drawing is too slow to keep up with the speed of incoming data, but the cycle boundaries will never shift with respect to signals.

    If you are scoping a periodic signal, setting code::cycle:: to match the signal's period will keep the waveform locked in place.


subsection:: Display

method::window
    The (parent) Window of the scope.

method::bounds
    The position and size of the window. The position is relative to the bottom-left corner of the screen.
    argument::
        A link::Classes/Rect::, or any object responding to the link::Search#asRect#.asRect:: method. The width less than 264 will be changed to 264, the minimum width.
    returns:: 
        A Rect.
code::
s.scope.bounds_(Rect(100, 200, 500, 600));
s.scope.bounds_([100, 200, 500, 600]);
s.scope.bounds_(Size(500, 600));
::
code::
s.scope.bounds_(Rect(0, 0, 500, 600));
s.scope.bounds_(500@600);
::

method::size
    Sets the width and the height of the scope window.
    argument::
        An Integer (the window is square).

method::toggleSize
    Toggle between small and large size.

method::zoom
    A synonym for link::#-xZoom::.

method::xZoom
    Magnifies the displayed wave horizontally to the given factor.

    This sets link::#-cycle:: to code::1024 * xZoom.reciprocal::.

    argument::
        A Float.

method::yZoom
    Magnifies the displayed wave vertically to the given factor.

    argument::
        A Float.

method::style
    The plotting style:
    list::
    ## 0 = the channels are vertically spaced
    ## 1 = the channels are overlaid
    ## 2 = lissajou; each pair of channels is used for 2D plotting (as streams of x and y coordinates).
    ::

    argument::
        One of the above Integers.
        
        


subsection:: Operation

method::run
    Starts the scope, if not already running.

method::quit
    Closes the window, and cleans up any used synths and buffers.


subsection:: Convenience

method::setProperties
    Sets several properties at once: link::#-numChannels::, link::#-index::, link::#-bufsize::, link::#-zoom::, and link::#-rate::.



examples::


subsection:: A step-by-step example
code::
s.boot;
(
{
    SinOsc.ar([225, 450, 900], 0, 0.2)
    + LPF.ar(
        LFPulse.ar(226 * [1, 2, 5], [0, 0.1, 0.1], 0.2, 0.2),
        MouseX.kr(20, 10000, 1)
        )
}.scope;
)

// server.scope only changes the properies explicitly given:

s.scope(numChannels: 5);
s.scope(index: 12);
s.scope(zoom: 4);
s.scope(index: 0);

s.scopeWindow.size = 600;
s.scopeWindow.size = 222;

// scoping buses:

a = Bus.audio(s, 4);
{ WhiteNoise.ar(0.2.dup(4)) }.play(s, a);

a.scope;

c = Bus.control(s, 3);
{ WhiteNoise.kr(1.dup(4) * MouseX.kr) }.play(s, c);

c.scope;

// note that scoping control rate buses shows block size interpolation (this is due to the
// fact that ScopeOut.kr doesn't work yet.)
::


subsection:: Multi-channel Lissajou plots
code::
(
{ 
	var f = { |l,h| SinOsc.kr(0.1, {pi.rand}).range(l, h) } ;
	Pulse.ar({ f.(20, 1000) }!6, { f.(0.0, 1) }!6, { f.(0.0, 1.0) }!6) 
}.play;
)

c = s.scope;
c.numChannels = 6;
c.scopeView.waveColors = [Color.red, Color.red, Color.cyan, Color.cyan, Color.white, Color.white];
c.style = 2;
::


subsection:: Embedded use
You can pass your own view in to add a stethoscope to it:

code::
w = Window.new("my own scope", Rect(20, 20, 400, 500));
w.view.decorator = FlowLayout(w.view.bounds);
c = Stethoscope.new(s, view: w.view);
w.onClose = { c.free }; // don't forget this
w.front;
::
